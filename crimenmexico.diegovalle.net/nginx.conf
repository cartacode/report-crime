map $http_accept_language $lang {
                default en;
                ~es es;
        }



server {
        listen 80; #deferred;
        #listen [::]:80;

        rewrite ^(/|/index.html)$ https://crimenmexico.diegovalle.net/$lang/;
        root /var/www/crimenmexico.diegovalle.net;
        index index.html;

        #Specify a charset
        charset utf-8;

        server_name crimenmexico.diegovalle.net;

        rewrite ^(/csv/|/csv/index.html)$ https://crimenmexico.diegovalle.net/en/csv permanent;
        rewrite ^(/municipios.html)$ https://crimenmexico.diegovalle.net/en/municipios.html permanent;
        rewrite ^(/federales.html)$ https://crimenmexico.diegovalle.net/en/federales.html permanent;
        rewrite ^(/en/csv)$ https://crimenmexico.diegovalle.net/en/datos.html permanent;
        rewrite ^(/es/csv)$ https://crimenmexico.diegovalle.net/es/datos.html permanent;
        rewrite ^(/en/csv/|/en/csv/index.html)$ https://crimenmexico.diegovalle.net/en/datos.html permanent;
        rewrite ^(/es/csv/|/es/csv/index.html)$ https://crimenmexico.diegovalle.net/es/datos.html permanent; 
        rewrite ^(/datos.html)$ https://crimenmexico.diegovalle.net/en/datos.html permanent;  
        rewrite ^(/en/csv/fuero-comun-municipios.csv.gz)$ https://crimenmexico.diegovalle.net/csv/fuero-comun-municipios.csv.gz;      

        error_page 404 /404.html;
        location  /404.html {
              internal;
              root /var/www/crimenmexico.diegovalle.net;
        }
        location / {
             try_files $uri $uri/index.html $uri.html =404;
        }


        gzip_static on;

        error_page 500 502 503 504 /50x.html;
        location = /50x.html {
              root /usr/share/nginx/www;
        }

        # cache.appcache, your document html and data
        location ~* \.(?:manifest|appcache|xml)$ {
          expires -1;
          # access_log logs/static.log; # I don't usually include a static log
        }

        location ~* \.(?:json|csv)$ {
          expires 20s;
          # access_log logs/static.log; # I don't usually include a static log
        }

        # Media: images, icons, video, audio, HTC
        location ~* \.(?:jpg|jpeg|gif|png|ico|cur|gz|svg|svgz|mp4|ogg|ogv|webm|htc|geojson)$ {
          expires 1M;
          access_log off;
          add_header Cache-Control "public";
        }

        # Feed
        location ~* \.(?:rss|atom)$ {
          expires 1h;
          add_header Cache-Control "public";
        }

        # CSS and Javascript
        location ~* \.(?:css|js)$ {
          expires 1y;
          access_log off;
          add_header Cache-Control "public";
        }

        location ~* (/en/|/es/) {
          expires -1;
          add_header Link "</assets/css/css/font.css>; rel=\"preload\"; as=\"style\"";
          add_header Link "</assets/js/jquery.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/jquery.dropotron.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/jquery.selectorr.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/jquery.poptrox.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/skel.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/skel-viewport.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/util.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/main.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/d3-tip/index.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/css/main.css>; rel=\"preload\";  as=\"style\"";
          add_header Link "</assets/css/crimenmexico.css>; rel=\"preload\";  as=\"style\"";
          add_header Link "</js/index.js>; rel=\"preload\";  as=\"script\"";
          add_header Link "</assets/json/mx_hexgrid.geojson>; rel=\"preload\";  as=\"script\"";
          add_header Link "</assets/json/states_last.json>; rel=\"preload\";   as=\"script\"";
          add_header Link "</assets/json/states.json>; rel=\"preload\";   as=\"script\"";
          add_header Link "</assets/json/national.json>; rel=\"preload\";  as=\"script\"";
          add_header Link "</assets/json/national_1990.json>; rel=\"preload\";  as=\"script\"";
          add_header Link "</assets/js/d3.min.js>; rel=\"preload\";   as=\"script\"";
          add_header Link "</assets/js/topojson.min.js>; rel=\"preload\";   as=\"script\"";
          add_header Link "</assets/js/metricsgraphics.js>; rel=\"preload\";   as=\"script\"";
          add_header Link "</assets/js/lodash.min.js>; rel=\"preload\";   as=\"script\"";
          add_header Link "</assets/css/metricsgraphics.min.css>; rel=\"preload\";   as=\"style\"";
          add_header Link "</assets/fonts/fontawesome-webfont.woff2?v=4.3.0>; rel=\"preload\";   as=\"font\"";
          add_header Link "</assets/css/images/bg01-blue.png>; rel=\"preload\"; as=\"image\"";
          add_header Link "</assets/css/images/bg01-brown.png>; rel=\"preload\"; as=\"image\"";
          add_header Link "</assets/css/images/bg01.png>; rel=\"preload\"; as=\"image\"";
          add_header Link "</assets/css/images/loader.gif>; rel=\"preload\"; as=\"image\"";
        }

        location ~* (/en/index.html|/es/index.html) {
          expires -1;
          add_header Link "</assets/css/css/font.css>; rel=\"preload\"; as=\"style\"";
          add_header Link "</assets/js/jquery.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/jquery.dropotron.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/jquery.selectorr.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/jquery.poptrox.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/skel.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/skel-viewport.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/util.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/main.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/d3-tip/index.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/css/main.css>; rel=\"preload\";  as=\"style\"";
          add_header Link "</assets/css/crimenmexico.css>; rel=\"preload\";  as=\"style\"";
          add_header Link "</js/index.js>; rel=\"preload\";  as=\"script\"";
          add_header Link "</assets/json/mx_hexgrid.geojson>; rel=\"preload\";  as=\"script\"";
          add_header Link "</assets/json/states_last.json>; rel=\"preload\";   as=\"script\"";
          add_header Link "</assets/json/states.json>; rel=\"preload\";   as=\"script\"";
          add_header Link "</assets/json/national.json; rel=\"preload\";  as=\"script\"";
          add_header Link "</assets/json/national_1990.json>; rel=\"preload\";  as=\"script\"";
          add_header Link "</assets/js/d3.min.js>; rel=\"preload\";   as=\"script\"";
          add_header Link "</assets/js/topojson.min.js>; rel=\"preload\";   as=\"script\"";
          add_header Link "</assets/js/metricsgraphics.js>; rel=\"preload\";   as=\"script\"";
          add_header Link "</assets/js/lodash.min.js>; rel=\"preload\";   as=\"script\"";
          add_header Link "</assets/css/metricsgraphics.min.css>; rel=\"preload\";   as=\"style\"";
          add_header Link "</assets/fonts/fontawesome-webfont.woff2?v=4.3.0>; rel=\"preload\";   as=\"font\"";
          add_header Link "</assets/css/images/bg01-blue.png>; rel=\"preload\"; as=\"image\"";
          add_header Link "</assets/css/images/bg01-brown.png>; rel=\"preload\"; as=\"image\"";
          add_header Link "</assets/css/images/bg01.png>; rel=\"preload\"; as=\"image\"";
          add_header Link "</assets/css/images/loader.gif>; rel=\"preload\"; as=\"image\"";
        }

        location ~* (/en/states.html|/es/states.html) {
          expires -1;
          add_header Link "</assets/css/css/font.css>; rel=\"preload\"; as=\"style\"";
          add_header Link "</assets/js/jquery.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/jquery.dropotron.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/jquery.selectorr.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/jquery.poptrox.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/skel.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/skel-viewport.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/util.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/main.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/d3-tip/index.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/css/main.css>; rel=\"preload\";  as=\"style\"";
          add_header Link "</assets/css/crimenmexico.css>; rel=\"preload\";  as=\"style\"";
          add_header Link "</js/states.js>; rel=\"preload\";  as=\"script\"";
          add_header Link "</assets/json/states_sm.json>; rel=\"preload\";   as=\"script\"";
          add_header Link "</assets/js/d3.min.js>; rel=\"preload\";   as=\"script\"";
          add_header Link "</assets/js/topojson.min.js>; rel=\"preload\";   as=\"script\"";
          add_header Link "</assets/js/metricsgraphics.js>; rel=\"preload\";   as=\"script\"";
          add_header Link "</assets/js/lodash.min.js>; rel=\"preload\";   as=\"script\"";
          add_header Link "</assets/css/metricsgraphics.min.css>; rel=\"preload\";   as=\"style\"";
          add_header Link "</assets/fonts/fontawesome-webfont.woff2?v=4.3.0>; rel=\"preload\";   as=\"font\"";
          add_header Link "</assets/css/images/bg01-brown.png>; rel=\"preload\"; as=\"image\"";
          add_header Link "</assets/css/images/bg01.png>; rel=\"preload\"; as=\"image\"";
          add_header Link "</assets/css/images/loader.gif>; rel=\"preload\"; as=\"image\"";
        }

        location ~* (/en/municipios.html|/es/municipios.html) {
          expires -1;
          add_header Link "</assets/css/css/font.css>; rel=\"preload\"; as=\"style\"";
          add_header Link "</assets/js/jquery.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/jquery.dropotron.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/jquery.selectorr.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/jquery.poptrox.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/skel.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/skel-viewport.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/util.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/main.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/d3-tip/index.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/css/main.css>; rel=\"preload\";  as=\"style\"";
          add_header Link "</assets/css/crimenmexico.css>; rel=\"preload\";  as=\"style\"";
          add_header Link "</js/muns.js>; rel=\"preload\";  as=\"script\"";
          add_header Link "</assets/json/municipios.json>; rel=\"preload\";   as=\"script\"";
          add_header Link "</assets/js/d3.min.js>; rel=\"preload\";   as=\"script\"";
          add_header Link "</assets/js/topojson.min.js>; rel=\"preload\";   as=\"script\"";
          add_header Link "</assets/js/metricsgraphics.js>; rel=\"preload\";   as=\"script\"";
          add_header Link "</assets/js/lodash.min.js>; rel=\"preload\";   as=\"script\"";
          add_header Link "</assets/css/metricsgraphics.min.css>; rel=\"preload\";   as=\"style\"";
          add_header Link "</assets/fonts/fontawesome-webfont.woff2?v=4.3.0>; rel=\"preload\";   as=\"style\"";
          add_header Link "</assets/css/images/bg01-brown.png>; rel=\"preload\"; as=\"image\"";
          add_header Link "</assets/css/images/bg01.png>; rel=\"preload\"; as=\"image\"";
          add_header Link "</assets/css/images/loader.gif>; rel=\"preload\"; as=\"image\"";
        }

        location ~* (/en/municipios-map.html|/es/municipios-map.html) {
          expires -1;
          add_header Link "</assets/css/css/font.css>; rel=\"preload\"; as=\"style\"";
          add_header Link "</assets/js/jquery.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/jquery.dropotron.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/jquery.selectorr.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/jquery.poptrox.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/skel.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/skel-viewport.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/util.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/main.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/d3-tip/index.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/css/main.css>; rel=\"preload\";  as=\"style\"";
          add_header Link "</assets/css/crimenmexico.css>; rel=\"preload\";  as=\"style\"";
          add_header Link "</assets/json/municipios-centroids.json>; rel=\"preload\";  as=\"script\"";
          add_header Link "</assets/js/crosslet.es.js>; rel=\"preload\";   as=\"script\"";
          add_header Link "</assets/fonts/fontawesome-webfont.woff2?v=4.3.0>; rel=\"preload\";   as=\"font\"";
          add_header Link "</assets/css/images/bg01-brown.png>; rel=\"preload\"; as=\"image\"";
          add_header Link "</assets/css/images/bg01.png>; rel=\"preload\"; as=\"image\"";
          add_header Link "</assets/css/images/loader.gif>; rel=\"preload\"; as=\"image\"";
        }

        location ~* (/en/anomalies.html|/es/anomalies.html) {
          expires -1;
          add_header Link "</assets/css/css/font.css>; rel=\"preload\"; as=\"style\"";
          add_header Link "</assets/js/jquery.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/jquery.dropotron.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/jquery.selectorr.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/jquery.poptrox.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/skel.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/skel-viewport.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/util.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/main.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/d3-tip/index.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/css/main.css>; rel=\"preload\";  as=\"style\"";
          add_header Link "</assets/css/crimenmexico.css>; rel=\"preload\";  as=\"style\"";
          add_header Link "</assets/json/estatal.json>; rel=\"preload\";  as=\"script\"";
          add_header Link "</assets/json/cities.json>; rel=\"preload\";   as=\"script\"";
          add_header Link "</assets/json/anomalies.json>; rel=\"preload\";   as=\"script\"";
          add_header Link "</assets/js/d3.min.js>; rel=\"preload\";   as=\"script\"";
          add_header Link "</assets/js/topojson.min.js>; rel=\"preload\";   as=\"script\"";
          add_header Link "</assets/js/metricsgraphics.js>; rel=\"preload\";   as=\"script\"";
          add_header Link "</assets/js/lodash.min.js>; rel=\"preload\";   as=\"script\"";
          add_header Link "</assets/css/metricsgraphics.min.css>; rel=\"preload\";   as=\"style\"";
          add_header Link "</assets/fonts/fontawesome-webfont.woff2?v=4.3.0>; rel=\"preload\";   as=\"font\"";
          add_header Link "</assets/css/images/bg01-brown.png>; rel=\"preload\"; as=\"image\"";
          add_header Link "</assets/css/images/bg01.png>; rel=\"preload\"; as=\"image\"";
          add_header Link "</assets/css/images/loader.gif>; rel=\"preload\"; as=\"image\"";
        }

        location ~* (/en/datos.html|/es/datos.html) {
          expires -1;
          add_header Link "</assets/css/css/font.css>; rel=\"preload\"; as=\"style\"";
          add_header Link "</assets/js/jquery.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/jquery.dropotron.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/jquery.selectorr.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/jquery.poptrox.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/skel.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/skel-viewport.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/util.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/main.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/d3-tip/index.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/css/main.css>; rel=\"preload\";  as=\"style\"";
          add_header Link "</assets/css/crimenmexico.css>; rel=\"preload\";  as=\"style\"";
          add_header Link "</assets/fonts/fontawesome-webfont.woff2?v=4.3.0>; rel=\"preload\";   as=\"font\"";
          add_header Link "</assets/css/images/bg01.png>; rel=\"preload\"; as=\"image\"";
          add_header Link "</assets/css/images/loader.gif>; rel=\"preload\"; as=\"image\"";
        }

        location ~* (/en/infographics.html|/es/infographics.html) {
          expires -1;
          add_header Link "</assets/css/css/font.css>; rel=\"preload\"; as=\"style\"";
          add_header Link "</assets/js/jquery.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/jquery.dropotron.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/jquery.selectorr.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/jquery.poptrox.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/skel.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/skel-viewport.min.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/util.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/main.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/js/d3-tip/index.js>; rel=\"preload\"; as=\"script\"";
          add_header Link "</assets/css/main.css>; rel=\"preload\";  as=\"style\"";
          add_header Link "</assets/css/crimenmexico.css>; rel=\"preload\";  as=\"style\"";
          add_header Link "</assets/fonts/fontawesome-webfont.woff2?v=4.3.0>; rel=\"preload\";   as=\"font\"";
          add_header Link "</assets/css/images/bg01.png>; rel=\"preload\"; as=\"image\"";
          add_header Link "</assets/css/images/loader.gif>; rel=\"preload\"; as=\"image\"";
        }

        # Include the basic h5bp config set
        include h5bp/basic.conf;

}
