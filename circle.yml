## Customize dependencies
dependencies:
  pre:
    - sudo apt update
    - if [ -d /tmp/.virtualenvs ]; then sudo cp -r /tmp/.virtualenvs /root/.virtualenvs; fi
    - virtualenv crimenmexico_ansible && source crimenmexico_ansible/bin/activate && pip install ansible

  override:
    # password for ansible ssh keys
    - echo $ANSIBLE_PASSWORD > ansible/password.txt
    - source crimenmexico_ansible/bin/activate && cd ansible && ansible-playbook -i "localhost," -c local playbook.yml --sudo --vault-password-file=password.txt  --extra-vars "secrets=true" && cd ..
    - sudo cp -r /root/.virtualenvs /tmp/.virtualenvs && sudo chown -R ubuntu:ubuntu /tmp/.virtualenvs
  
  # we automatically cache and restore many dependencies between
  # builds. If you need to, you can add custom paths to cache:
  cache_directories:
    - /tmp/.virtualenvs
    - /usr/local/lib/R/site-library	
    - /usr/lib/R/site-library
    - /usr/lib/R/library

## Customize test commands
test:
  override:  
    - sudo -H bash -c "cd /root/new.crimenmexico && source /root/.virtualenvs/crimenmexico/bin/activate && ./build.sh"
